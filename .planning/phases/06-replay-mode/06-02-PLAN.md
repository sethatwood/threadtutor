---
phase: 06-replay-mode
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - public/demo.json
  - components/topic-picker.tsx
autonomous: true

must_haves:
  truths:
    - "New visitors without an API key see the demo replay automatically on first visit"
    - "The demo session covers Bitcoin proof-of-work with 12-20 turns and 2-3 confidence checks"
    - "Visitors can exit replay and return to the topic picker to start their own live session"
    - "Confidence checks in the demo show the original user's response and Claude's assessment"
  artifacts:
    - path: "public/demo.json"
      provides: "Pre-recorded Bitcoin proof-of-work demo session"
      contains: "proof-of-work"
    - path: "components/topic-picker.tsx"
      provides: "Entry point that loads demo.json and renders ReplayShell for visitors without API keys"
  key_links:
    - from: "components/topic-picker.tsx"
      to: "public/demo.json"
      via: "fetch('/demo.json') on mount when no API key"
      pattern: "fetch.*demo\\.json"
    - from: "components/topic-picker.tsx"
      to: "components/replay-shell.tsx"
      via: "renders ReplayShell when demoSession is loaded"
      pattern: "ReplayShell.*demoSession"
---

<objective>
Create the demo.json data file and wire replay mode into TopicPicker as the default experience for visitors without API keys.

Purpose: Completes the replay feature end-to-end. New visitors land on a working demo that showcases ThreadTutor's Socratic teaching and concept map without needing an API key.
Output: public/demo.json containing a curated Bitcoin proof-of-work session, and updated TopicPicker that auto-loads replay for keyless visitors.
</objective>

<execution_context>
@/Users/yayseth/.claude/get-shit-done/workflows/execute-plan.md
@/Users/yayseth/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/06-replay-mode/06-RESEARCH.md
@.planning/phases/06-replay-mode/06-01-SUMMARY.md

@lib/types.ts
@components/topic-picker.tsx
@components/replay-shell.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create demo.json with Bitcoin proof-of-work session</name>
  <files>public/demo.json</files>
  <action>
    Hand-craft `public/demo.json` as a valid `Session` object:

    Structure:
    ```json
    {
      "id": "demo-bitcoin-pow",
      "topic": "Bitcoin proof-of-work",
      "createdAt": "2026-02-15T00:00:00.000Z",
      "turns": [...]
    }
    ```

    Turn sequence (14-16 turns total):
    1. Turn 1 (user): "I'd like to learn about Bitcoin proof-of-work"
    2. Turn 2 (assistant): Opening Socratic question about what the learner already knows about Bitcoin. Introduce root concept "bitcoin" with parentId: null. journalEntry summarizes the starting point.
    3. Turn 3 (user): Brief learner response showing basic awareness
    4. Turn 4 (assistant): Builds on response, introduces "proof-of-work" concept (parentId: "bitcoin") and asks a guiding question about why mining is needed. journalEntry about proof-of-work purpose.
    5. Turn 5 (user): Learner's response about mining
    6. Turn 6 (assistant): Introduces "hash-functions" (parentId: "proof-of-work"), explains cryptographic hashing with a Socratic question. Includes confidenceCheck with question about hashing. journalEntry about hash functions.
    7. Turn 7 (user): Response to confidence check (answers the hash question)
    8. Turn 8 (assistant): Confidence check assessed as "tracking" with feedback. Introduces "mining-difficulty" (parentId: "proof-of-work") and "target-value" (parentId: "mining-difficulty"). journalEntry about difficulty adjustment.
    9. Turn 9 (user): Asks about nonce
    10. Turn 10 (assistant): Introduces "nonce" (parentId: "hash-functions") and "block-header" (parentId: "bitcoin"). Explains the mining loop. journalEntry about nonce iteration.
    11. Turn 11 (user): Response about understanding mining
    12. Turn 12 (assistant): Introduces "consensus" (parentId: "bitcoin") and "longest-chain" (parentId: "consensus"). Includes confidenceCheck about why longest chain matters. journalEntry about consensus mechanism.
    13. Turn 13 (user): Response to confidence check
    14. Turn 14 (assistant): Confidence check assessed as "partial" with encouraging feedback. Introduces "double-spending" (parentId: "consensus") and "block-reward" (parentId: "mining-difficulty"). journalEntry about economic incentives.
    15. Turn 15 (user): Question about energy use
    16. Turn 16 (assistant): Introduces "energy-consumption" (parentId: "proof-of-work") and "proof-of-stake" (parentId: "consensus"). Includes confidenceCheck about tradeoffs. journalEntry about environmental considerations.

    Rules for hand-crafting:
    - Every turn has: turnNumber (sequential starting at 1), role, displayText, concepts (empty array for user turns), confidenceCheck (null for user turns and assistant turns without checks), journalEntry (null for user turns)
    - Assistant displayText should be 2-4 sentences, Socratic in tone (asking questions, not lecturing), using markdown sparingly. NO em dashes anywhere.
    - Concept ids are lowercase kebab-case slugs
    - Each concept has: id, label (Title Case), parentId (null for root, existing id for children), description (1 sentence)
    - confidenceCheck objects: { question: string, assessment: "tracking"|"partial"|"confused", feedback: string } -- all three fields present for assessed checks
    - User displayText should be 1-2 sentences showing genuine learning engagement
    - The concept graph should form a coherent tree rooted at "bitcoin"
    - Validate JSON is well-formed before saving
  </action>
  <verify>Run `node -e "const s = require('./public/demo.json'); console.log('turns:', s.turns.length, 'concepts:', s.turns.flatMap(t => t.concepts).length)"` to verify turn count and concept count</verify>
  <done>demo.json contains a valid Session with 14-16 turns, 10+ concepts forming a tree, 2-3 confidence checks with assessments, and Socratic teaching style throughout</done>
</task>

<task type="auto">
  <name>Task 2: Wire replay into TopicPicker as default visitor experience</name>
  <files>components/topic-picker.tsx</files>
  <action>
    Modify `components/topic-picker.tsx` to load and display the demo replay for visitors without an API key:

    1. Add state: `demoSession: Session | null` (starts null), `demoLoading: boolean` (starts true), `demoError: string | null` (starts null)
    2. Add import for `ReplayShell` from `@/components/replay-shell`
    3. Add useEffect that runs after apiKeyLoaded: if no API key is stored (`!apiKey`), fetch `/demo.json`, parse as Session, set `demoSession`. On error, set `demoError` and `demoLoading` to false. On success, set `demoLoading` to false.
    4. If the user has an API key, skip the demo fetch entirely (set demoLoading to false immediately).

    Rendering logic (in order of priority):
    - If `loadedSession` exists: render ConversationShell with it (existing behavior, unchanged)
    - If `started` is true: render ConversationShell (existing behavior, unchanged)
    - If `demoSession` exists and user has not started a live session: render `<ReplayShell session={demoSession} onBack={() => setDemoSession(null)} />`
      - When the user exits replay (onBack), set demoSession to null, which falls through to the topic picker form
    - Otherwise: render the topic picker form (existing behavior)

    In the topic picker form, add a "Watch demo" button ABOVE the "Start learning" button:
    - Only shown when `!demoSession && !demoLoading && !demoError` and there is no API key stored
    - Actually: show the button when `demoError` is null and demo was not loaded, as a way for users WITH API keys to also watch the demo
    - Button text: "Watch demo" with a brief subtitle like "See how ThreadTutor works"
    - Style: secondary style -- `w-full rounded-lg border border-zinc-700 bg-zinc-800/60 px-4 py-3 text-base font-medium text-zinc-300 hover:border-indigo-500/50 hover:bg-indigo-500/10 hover:text-indigo-300 transition-colors`
    - On click: fetch demo.json (reuse same fetch logic), set demoSession

    For keyless visitors:
    - While loading demo: show a subtle loading state (e.g., "Loading demo..." text centered on screen)
    - On demo fetch error: fall through to the normal topic picker (they can enter an API key)

    Key behavior: The demo auto-loads for visitors WITHOUT an API key. Visitors WITH an API key see the normal topic picker with a "Watch demo" button option.
  </action>
  <verify>`npm run build` succeeds; manually verify the render logic order handles all states correctly</verify>
  <done>New visitors without API keys automatically see the demo replay; visitors with keys see normal topic picker plus a "Watch demo" option; exiting replay returns to topic picker</done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no errors
2. `public/demo.json` is valid JSON matching the Session type
3. Demo has 14-16 turns, 10+ concepts, 2-3 confidence checks with assessments
4. TopicPicker auto-loads demo for keyless visitors
5. TopicPicker shows "Watch demo" button for visitors with API keys
6. Exiting replay returns to the topic picker
7. No em dashes in any demo content
</verification>

<success_criteria>
- New visitors land on a Bitcoin proof-of-work demo replay without entering anything
- The demo session has a natural Socratic teaching flow with concept graph and journal entries
- Visitors can exit replay and enter their own API key/topic to start a live session
- Visitors with existing API keys can optionally watch the demo via a button
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-replay-mode/06-02-SUMMARY.md`
</output>
