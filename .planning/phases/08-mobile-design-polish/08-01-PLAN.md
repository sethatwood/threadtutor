---
phase: 08-mobile-design-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/conversation-shell.tsx
  - components/replay-shell.tsx
  - components/app-header.tsx
  - components/replay-controls.tsx
  - components/concept-map.tsx
  - components/learning-journal.tsx
autonomous: true

must_haves:
  truths:
    - "On mobile (<768px), the layout stacks vertically with conversation on top, concept map below, and journal collapsible"
    - "The concept map renders at a usable fixed height (~250px) on mobile, not collapsed to 0"
    - "The learning journal is collapsible on mobile via a details/summary toggle, and always visible on desktop"
    - "The header is compact on mobile: tagline and topic breadcrumb are hidden, padding is reduced"
    - "Replay controls and header buttons have minimum 44px touch targets on mobile"
    - "Desktop layout is unchanged from current three-panel side-by-side"
  artifacts:
    - path: "components/conversation-shell.tsx"
      provides: "Responsive three-panel layout with mobile stacking"
      contains: "flex-col"
    - path: "components/replay-shell.tsx"
      provides: "Responsive three-panel replay layout with mobile stacking"
      contains: "flex-col"
    - path: "components/app-header.tsx"
      provides: "Compact mobile header with hidden tagline/topic"
      contains: "md:block"
    - path: "components/replay-controls.tsx"
      provides: "Touch-friendly replay buttons"
      contains: "min-h-\\[44px\\]"
    - path: "components/learning-journal.tsx"
      provides: "Journal with collapsible mobile wrapper support"
  key_links:
    - from: "components/conversation-shell.tsx"
      to: "components/learning-journal.tsx"
      via: "Mobile: details/summary wrapper. Desktop: always-visible div."
      pattern: "md:hidden|hidden md:flex"
    - from: "components/replay-shell.tsx"
      to: "components/learning-journal.tsx"
      via: "Same mobile/desktop pattern as ConversationShell"
      pattern: "md:hidden|hidden md:flex"
---

<objective>
Convert the desktop-only three-panel layout to a responsive mobile layout in both ConversationShell and ReplayShell, compact the header for mobile, make the journal collapsible on mobile, and ensure touch targets meet the 44px minimum.

Purpose: UI-02 requires mobile layout stacking (conversation on top, concept map below, journal collapsible). This is the structural responsive CSS work.
Output: Both shell components are responsive, header is compact on mobile, journal is collapsible, touch targets are adequate.
</objective>

<execution_context>
@/Users/yayseth/.claude/get-shit-done/workflows/execute-plan.md
@/Users/yayseth/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-mobile-design-polish/08-RESEARCH.md

@components/conversation-shell.tsx
@components/replay-shell.tsx
@components/app-header.tsx
@components/replay-controls.tsx
@components/concept-map.tsx
@components/learning-journal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Responsive shell layout and compact header</name>
  <files>
    components/conversation-shell.tsx
    components/replay-shell.tsx
    components/app-header.tsx
  </files>
  <action>
Convert the three-panel layout in both ConversationShell and ReplayShell from desktop-only to mobile-first responsive.

**ConversationShell (`conversation-shell.tsx`):**

1. Change the three-panel container from `flex flex-1 overflow-hidden` to `flex flex-1 flex-col overflow-hidden md:flex-row`.

2. Concept map panel (currently `w-1/4 border-r border-zinc-800`): Change to `order-2 h-[250px] shrink-0 border-t border-zinc-800 md:order-first md:h-auto md:w-1/4 md:border-r md:border-t-0`. The fixed `h-[250px]` prevents React Flow from collapsing to 0 height on mobile.

3. Conversation panel (currently `flex w-1/2 flex-col`): Change to `order-1 flex min-h-0 flex-1 flex-col md:order-2 md:w-1/2`. The `order-1` puts it first on mobile. The `min-h-0` prevents flex overflow issues.

4. Journal panel (currently `w-1/4 border-l border-zinc-800`): Change to `order-3 border-t border-zinc-800 md:w-1/4 md:border-l md:border-t-0`. Then split rendering into mobile (collapsible `<details>`) and desktop (always visible):

```tsx
<div className="order-3 border-t border-zinc-800 md:w-1/4 md:border-l md:border-t-0">
  {/* Mobile: collapsible */}
  <details className="group md:hidden">
    <summary className="flex cursor-pointer items-center justify-between px-4 py-3 text-sm font-semibold text-zinc-300">
      Learning Journal
      <svg className="h-4 w-4 text-zinc-500 transition-transform group-open:rotate-180" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fillRule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clipRule="evenodd" />
      </svg>
    </summary>
    <div className="max-h-[250px] overflow-y-auto">
      <LearningJournal turns={state.turns} />
    </div>
  </details>
  {/* Desktop: always visible */}
  <div className="hidden md:flex md:h-full md:flex-col">
    <LearningJournal turns={state.turns} />
  </div>
</div>
```

**ReplayShell (`replay-shell.tsx`):**

Apply the exact same responsive pattern as ConversationShell:
- Same flex-col/md:flex-row on the container
- Same order classes on concept map, conversation+controls, and journal panels
- Same h-[250px] on concept map mobile container
- Same details/summary collapsible journal pattern
- Use `replay.visibleTurns` instead of `state.turns` for LearningJournal

**AppHeader (`app-header.tsx`):**

1. Reduce padding on mobile: change `px-6 py-3` to `px-4 py-2 md:px-6 md:py-3`.
2. Reduce gap: change `gap-3` to `gap-2 md:gap-3`.
3. Hide tagline on mobile: add `hidden md:block` to the tagline `<span>`.
4. Hide topic breadcrumb divider and text on mobile: add `hidden md:inline` to the `/` separator and topic `<span>`.
5. Scale title down on mobile: change `text-base` to `text-sm md:text-base`.

Do NOT change LogoMark, mode badges, or children slot rendering.
  </action>
  <verify>
Run `npm run build` to confirm no TypeScript or build errors. Then visually inspect: open dev tools, toggle mobile viewport (375px width) and confirm:
1. Panels stack vertically (conversation, then map, then journal)
2. Header shows only logo + "ThreadTutor" text + mode badge + buttons (no tagline, no topic breadcrumb)
3. Desktop viewport (1280px+) shows the original three-panel side-by-side layout unchanged
  </verify>
  <done>
Both shells render stacked on mobile (< 768px) and side-by-side on desktop (>= 768px). Header is compact on mobile. Journal has a collapsible details/summary on mobile and is always visible on desktop.
  </done>
</task>

<task type="auto">
  <name>Task 2: Touch targets and concept map mobile refinements</name>
  <files>
    components/replay-controls.tsx
    components/concept-map.tsx
    components/app-header.tsx
  </files>
  <action>
Ensure interactive elements meet the 44px minimum touch target on mobile and refine the concept map for mobile use.

**ReplayControls (`replay-controls.tsx`):**

1. Update `buttonBase` to include minimum touch target: add `min-h-[44px]` to the class string. The existing `px-3 py-1.5` is tight on mobile. Change to `px-4 py-2 md:px-3 md:py-1.5` for larger mobile taps with compact desktop appearance.
2. The container padding: change `px-6 py-3` to `px-4 py-2 md:px-6 md:py-3`.
3. Change gap from `gap-4` to `gap-3 md:gap-4`.

**ConceptMap (`concept-map.tsx`):**

1. Add `preventScrolling={false}` prop to the `<ReactFlow>` component. This allows the mobile page to scroll past the concept map container instead of trapping scroll events. The concept map is already in a fixed-height container on mobile, so this is safe.
2. Increase the fit-all button touch target: change `p-1.5` to `p-2 md:p-1.5` and ensure the button itself is at least 44x44 by adding `min-h-[44px] min-w-[44px] flex items-center justify-center`.
3. Increase the SVG icon size on mobile: change from fixed `width="16" height="16"` to className-based sizing `className="h-4 w-4 md:h-4 md:w-4"` (keep same size but use Tailwind for consistency). Actually, keep the 16x16 icon -- the larger button padding gives adequate touch area.

**AppHeader buttons (`app-header.tsx`):**

The header action buttons (Export, New topic, Try it live, Exit) are rendered via the `children` slot from each shell. They already have `px-3 py-1.5` which is borderline. Add minimum touch target enforcement by adding `min-h-[44px]` to each button in `conversation-shell.tsx` and `replay-shell.tsx` where they are defined.

Wait -- the buttons are defined in the shell files, not in app-header.tsx. Add `min-h-[44px]` to the Export and New topic buttons in `conversation-shell.tsx`, and to the "Try it live" and "Exit" buttons in `replay-shell.tsx`. These files are already modified in Task 1, so this task just adds the touch target class to those buttons.

No changes to app-header.tsx in this task (touch target changes are in the shell files from Task 1 -- add the `min-h-[44px]` class to each header button there).
  </action>
  <verify>
Run `npm run build` to confirm no errors. In browser dev tools at 375px mobile viewport:
1. Replay controls buttons are visually larger and easy to tap
2. The concept map allows page scrolling past it (not trapped)
3. The fit-all button in the concept map is comfortably tappable
4. Header action buttons have adequate touch target size
  </verify>
  <done>
All interactive elements on mobile have at least 44px touch targets. The concept map allows page scroll-through on mobile via preventScrolling={false}. Replay controls are sized for touch input.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. Mobile viewport (375px): layout stacks vertically -- conversation first, concept map second (250px height), journal third (collapsible)
3. Mobile viewport: header shows logo + title + badge + buttons only (no tagline, no topic breadcrumb)
4. Mobile viewport: journal expands/collapses via tap on "Learning Journal" summary
5. Mobile viewport: all buttons and controls are comfortably tappable (44px+)
6. Desktop viewport (1280px+): layout is unchanged three-panel side-by-side
7. Desktop viewport: journal is always visible (no details/summary)
8. Concept map on mobile does not trap scroll events
</verification>

<success_criteria>
The app renders a stacked mobile layout at < 768px with conversation on top, concept map at a fixed height below, and a collapsible journal at the bottom. Desktop layout (>= 768px) is identical to the current three-panel design. All touch targets meet the 44px minimum. The concept map does not trap scroll on mobile.
</success_criteria>

<output>
After completion, create `.planning/phases/08-mobile-design-polish/08-01-SUMMARY.md`
</output>
