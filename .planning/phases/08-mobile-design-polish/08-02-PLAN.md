---
phase: 08-mobile-design-polish
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/globals.css
  - app/api/chat/route.ts
  - components/message.tsx
  - components/conversation-panel.tsx
  - components/confidence-check.tsx
  - components/topic-picker.tsx
autonomous: true

must_haves:
  truths:
    - "Text renders in Geist Sans font across the entire app, not Arial"
    - "Messages have generous whitespace and clean, educational typography"
    - "No em dashes (U+2014) or en dashes (U+2013) appear in any rendered text, including runtime Claude output"
    - "Prose content scales down slightly on mobile (prose-sm) and uses standard size on desktop (prose-base)"
  artifacts:
    - path: "app/globals.css"
      provides: "Fixed font-family using Geist font variable"
      contains: "var(--font-sans)"
    - path: "app/api/chat/route.ts"
      provides: "Runtime em dash sanitization on all text fields from Claude"
      contains: "sanitizeEmDashes"
    - path: "components/message.tsx"
      provides: "Responsive prose sizing and improved message spacing"
      contains: "prose-sm"
  key_links:
    - from: "app/api/chat/route.ts"
      to: "lib/use-conversation.ts"
      via: "API route sanitizes em dashes before JSON reaches the client"
      pattern: "sanitizeEmDashes"
    - from: "app/globals.css"
      to: "app/layout.tsx"
      via: "Font variable set on body element, consumed by all components"
      pattern: "var(--font-sans)"
---

<objective>
Fix the font stack to use Geist Sans, improve typography and whitespace for a clean educational aesthetic, and add em dash sanitization as a belt-and-suspenders measure.

Purpose: UI-03 (clean, minimal, educational design) and UI-04 (no em dashes). The font is currently overridden by a hardcoded Arial rule, and while the system prompt prohibits em dashes, runtime sanitization ensures the constraint holds even if Claude occasionally produces them.
Output: Geist Sans renders everywhere, messages have better spacing, and em dashes are sanitized from all Claude responses.
</objective>

<execution_context>
@/Users/yayseth/.claude/get-shit-done/workflows/execute-plan.md
@/Users/yayseth/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-mobile-design-polish/08-RESEARCH.md

@app/globals.css
@app/api/chat/route.ts
@components/message.tsx
@components/conversation-panel.tsx
@components/confidence-check.tsx
@components/topic-picker.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix font stack and improve typography/spacing</name>
  <files>
    app/globals.css
    components/message.tsx
    components/conversation-panel.tsx
    components/confidence-check.tsx
    components/topic-picker.tsx
  </files>
  <action>
Fix the font stack bug and refine spacing/typography across the app for a cleaner, more educational (Notion-like) feel.

**globals.css:**

1. Line 28: Replace `font-family: Arial, Helvetica, sans-serif;` with `font-family: var(--font-sans), system-ui, sans-serif;`. This uses the Geist Sans font loaded via `next/font/google` in layout.tsx. The `--font-sans` CSS variable is already mapped to `--font-geist-sans` in the `@theme inline` block.

**message.tsx:**

1. Increase message vertical padding for more generous whitespace: change `py-6` to `py-5 md:py-6` on both user and assistant message containers. Mobile gets slightly tighter spacing since screen real estate is limited.

2. Make prose responsive: change the assistant message prose classes from `prose prose-invert prose-base max-w-none` to `prose prose-invert prose-sm md:prose-base max-w-none`. This scales text down slightly on mobile for better readability in the narrower viewport.

3. Keep all existing prose color overrides (`prose-p:text-zinc-200 prose-headings:text-zinc-100 prose-strong:text-zinc-100 prose-code:text-indigo-300 prose-code:bg-zinc-800 prose-pre:bg-zinc-800`) unchanged.

**conversation-panel.tsx:**

1. Increase the input area bottom padding slightly for breathing room: change `py-4` to `py-3 md:py-4` on the input container div (the one with `border-t border-zinc-800 px-6 py-4`).

2. Add responsive horizontal padding to the message list area: change `px-6` to `px-4 md:px-6` on the message list container and `mx-6` to `mx-4 md:mx-6` on the error banner and `px-6` to `px-4 md:px-6` on the input area container. This gives mobile a bit more content width while keeping desktop padding generous.

**confidence-check.tsx:**

1. Add responsive padding: change `p-4` to `p-3 md:p-4` on the outer card div for slightly tighter mobile presentation.

**topic-picker.tsx:**

1. Increase the top-level vertical padding: change `py-12` to `py-8 md:py-12` on the outer container for better mobile centering.

2. Reduce the bottom margin on the branding section: change `mb-12` to `mb-8 md:mb-12`.

Do NOT change any colors, component structure, or logic. This is purely spacing and typography refinement.
  </action>
  <verify>
Run `npm run build` to confirm no errors. In browser:
1. Open dev tools, inspect `<body>` element: computed font-family should show Geist Sans (or the CSS variable value), NOT Arial
2. Messages should have clean, readable spacing with generous whitespace
3. On mobile viewport (375px), prose text should be slightly smaller than desktop
4. Topic picker should look well-centered on mobile without excessive top padding
  </verify>
  <done>
The entire app renders in Geist Sans. Messages have clean, generous spacing. Prose scales responsively (prose-sm on mobile, prose-base on desktop). Padding is responsive across all interactive areas.
  </done>
</task>

<task type="auto">
  <name>Task 2: Em dash sanitization in API route</name>
  <files>
    app/api/chat/route.ts
  </files>
  <action>
Add a belt-and-suspenders em dash sanitization step in the API route, after parsing the structured JSON from Claude but before returning it to the client. The system prompt already prohibits em dashes, but LLM instruction following is probabilistic. This ensures the UI-04 constraint holds for runtime output.

1. Add a `sanitizeEmDashes` helper function at the top of the file (after imports, before the POST handler):

```typescript
/**
 * Replace em dashes (U+2014) and en dashes (U+2013) with hyphens.
 * Belt-and-suspenders: the system prompt prohibits em dashes, but
 * Claude may occasionally produce them anyway.
 */
function sanitizeEmDashes(text: string): string {
  return text
    .replace(/\u2014/g, " - ")  // em dash -> space-hyphen-space
    .replace(/\u2013/g, "-");   // en dash -> hyphen
}
```

2. After `const turnData = JSON.parse(textBlock.text);` (line 101), apply sanitization to all text fields before returning:

```typescript
const turnData = JSON.parse(textBlock.text);

// Sanitize em/en dashes from all text fields
if (turnData.displayText) {
  turnData.displayText = sanitizeEmDashes(turnData.displayText);
}
if (turnData.journalEntry) {
  turnData.journalEntry = sanitizeEmDashes(turnData.journalEntry);
}
if (turnData.confidenceCheck) {
  if (turnData.confidenceCheck.question) {
    turnData.confidenceCheck.question = sanitizeEmDashes(turnData.confidenceCheck.question);
  }
  if (turnData.confidenceCheck.feedback) {
    turnData.confidenceCheck.feedback = sanitizeEmDashes(turnData.confidenceCheck.feedback);
  }
}
if (turnData.concepts) {
  for (const concept of turnData.concepts) {
    if (concept.label) {
      concept.label = sanitizeEmDashes(concept.label);
    }
    if (concept.description) {
      concept.description = sanitizeEmDashes(concept.description);
    }
  }
}

return NextResponse.json(turnData);
```

3. Also run a final grep across the entire codebase (excluding node_modules and .next) to confirm zero em dashes exist in any source file, data file, or session file:

After implementing, the executor should run: `grep -r $'\u2014' --include='*.ts' --include='*.tsx' --include='*.json' --include='*.css' --include='*.md' . | grep -v node_modules | grep -v .next`

If any matches are found, replace them with appropriate alternatives (hyphen, comma, or reword).
  </action>
  <verify>
1. `npm run build` passes
2. `grep -r $'\u2014' --include='*.ts' --include='*.tsx' --include='*.json' --include='*.css' . | grep -v node_modules | grep -v .next` returns zero matches
3. `grep -r $'\u2013' --include='*.ts' --include='*.tsx' --include='*.json' --include='*.css' . | grep -v node_modules | grep -v .next` returns zero matches (only the sanitizer function itself should reference these via unicode escapes, which grep for the literal character won't match)
4. Read the API route and confirm `sanitizeEmDashes` is called on all text fields before `NextResponse.json(turnData)`
  </verify>
  <done>
The API route sanitizes em dashes and en dashes from all text fields in Claude's structured response before sending to the client. A codebase grep confirms zero literal em/en dashes exist in any source or data file.
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. Body element computed font-family is Geist Sans (not Arial)
3. Messages render with clean spacing and responsive prose sizing
4. Em dash grep of entire codebase returns zero matches
5. API route includes sanitizeEmDashes applied to displayText, journalEntry, confidenceCheck.question, confidenceCheck.feedback, concept.label, and concept.description
6. Topic picker and input areas have responsive padding
</verification>

<success_criteria>
The app renders entirely in Geist Sans. Typography is clean with responsive prose sizing (prose-sm on mobile, prose-base on desktop). Spacing is generous and educational (Notion-like). The API route sanitizes em and en dashes from all Claude response text fields. A codebase-wide grep confirms zero literal em/en dashes.
</success_criteria>

<output>
After completion, create `.planning/phases/08-mobile-design-polish/08-02-SUMMARY.md`
</output>
