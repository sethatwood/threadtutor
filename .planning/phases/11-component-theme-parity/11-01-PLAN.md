---
phase: 11-component-theme-parity
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/concept-map.tsx
  - app/globals.css
autonomous: true

must_haves:
  truths:
    - "Concept map nodes, edges, and background render correctly in light theme (not dark-on-dark)"
    - "React Flow controls (zoom, fit) render with appropriate colors matching the current theme"
    - "Fullscreen concept map modal background and controls adapt to the current theme"
    - "Concept node glow animation colors are visible against both dark and light backgrounds"
  artifacts:
    - path: "components/concept-map.tsx"
      provides: "Dynamic colorMode based on current theme"
      contains: "useTheme"
    - path: "app/globals.css"
      provides: "Light-mode React Flow overrides and theme-aware concept node keyframes"
      contains: "react-flow.light"
  key_links:
    - from: "components/concept-map.tsx"
      to: "lib/theme.tsx"
      via: "useTheme hook for dynamic colorMode"
      pattern: "useTheme.*colorMode"
    - from: "app/globals.css"
      to: "components/concept-map.tsx"
      via: "CSS class selectors matching React Flow colorMode"
      pattern: "react-flow\\.(dark|light)"
---

<objective>
Make the concept map (React Flow) fully theme-aware so it renders correctly in both dark and light modes.

Purpose: Currently `colorMode="dark"` is hardcoded in concept-map.tsx, meaning the React Flow controls, background, and internal styling always render as dark regardless of the app's active theme. The CSS overrides in globals.css only target `.react-flow.dark`, leaving light mode without custom styling. This plan fixes both the dynamic colorMode prop and the CSS overrides.

Output: Concept map renders correctly in both themes, including inline and fullscreen views, with appropriate node/edge/control styling.
</objective>

<execution_context>
@/Users/yayseth/.claude/get-shit-done/workflows/execute-plan.md
@/Users/yayseth/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-theme-system/10-01-SUMMARY.md
@.planning/phases/10-theme-system/10-02-SUMMARY.md

@components/concept-map.tsx
@app/globals.css
@lib/theme.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dynamic React Flow colorMode and light-mode CSS overrides</name>
  <files>components/concept-map.tsx, app/globals.css</files>
  <action>
In concept-map.tsx:
1. Import `useTheme` from `@/lib/theme`
2. In the `ConceptMap` outer component, call `const { theme } = useTheme()` to get the current theme
3. Pass `theme` as a prop to both `InlineMapInner` and `FullscreenMapInner` (add to their Props interfaces)
4. Replace the hardcoded `colorMode="dark"` on both ReactFlow instances with `colorMode={theme === "dark" ? "dark" : "light"}`
5. This ensures React Flow's internal styling (controls, minimap, background) adapts to the active theme

In globals.css:
1. Add a new `.react-flow.light` CSS block adjacent to the existing `.react-flow.dark` block
2. The light-mode overrides should set:
   - `--xy-background-color-default: transparent` (same as dark)
   - `--xy-node-background-color-default: var(--color-surface)` (same pattern)
   - `--xy-node-border-default: 1px solid var(--color-accent-indigo)` (same pattern)
   - `--xy-node-color-default: var(--color-text)` (same pattern)
   - `--xy-edge-stroke-default: color-mix(in srgb, var(--color-accent-indigo) 40%, transparent)` (same pattern)
3. Make concept-node--new border-color and box-shadow use `var(--color-accent-indigo)` and `var(--color-accent-indigo-hover)` instead of hardcoded `#818cf8` and `#6366f1`
4. Update `@keyframes concept-pulse` to use `var(--color-accent-indigo)` and `var(--color-accent-indigo-hover)` instead of hardcoded hex values
5. Update `@keyframes concept-glow-fade` `from` block to use `var(--color-accent-indigo-hover)` instead of `#818cf8`
6. Keep `.concept-node:hover` border-color using `var(--color-accent-indigo)` instead of `#6366f1`

Note: The CSS variables already resolve to appropriate values per theme (defined in the [data-theme] blocks), so using them in keyframes and pseudo-classes automatically adapts to both themes.
  </action>
  <verify>
1. `grep 'colorMode="dark"' components/concept-map.tsx` returns zero matches (no more hardcoded dark)
2. `grep 'useTheme' components/concept-map.tsx` returns a match (hook is imported and used)
3. `grep 'react-flow.light' app/globals.css` returns a match (light overrides exist)
4. `grep '#818cf8\|#6366f1' app/globals.css` returns zero matches in the concept-node sections (all replaced with CSS variables) -- note: the [data-theme] palette definitions at the top of the file will still contain these hex values as the source-of-truth definitions, which is correct
5. `npm run build` passes
  </verify>
  <done>React Flow colorMode is dynamic based on useTheme, light-mode CSS overrides exist, and all concept node animation colors use CSS custom properties instead of hardcoded hex values</done>
</task>

</tasks>

<verification>
1. In concept-map.tsx: `colorMode` prop is derived from `useTheme()`, not hardcoded
2. In globals.css: Both `.react-flow.dark` and `.react-flow.light` override blocks exist with theme-aware variables
3. In globals.css: concept-node hover, new, pulse, and glow-fade all use `var(--color-accent-*)` instead of hex literals
4. `npm run build` passes with zero errors
</verification>

<success_criteria>
- React Flow renders with `colorMode="light"` when app is in light theme, `colorMode="dark"` when in dark theme
- Concept map nodes, edges, controls, and animations display correctly against both backgrounds
- Fullscreen modal concept map also adapts to current theme
- No hardcoded color hex values remain in concept-node CSS (except in the palette definitions)
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/11-component-theme-parity/11-01-SUMMARY.md`
</output>
